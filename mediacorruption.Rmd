---
title: "Media corruption"
output:
  html_notebook: default
  html_document: default

---

Dưới đây là kết quả scraping web vnexpress.net (5 chuyên mục bao gồm pháp luật, thời sự, kinh doanh, giáo dục và cộng đồng). Codebook của dự án media corruption được tham khảo để theo dõi sự thay đổi trong thông tin về tham nhũng trên báo mạng.

```{r include=FALSE}
library(readr)
library(stringr)
library(lubridate)
library(dplyr)

dir = "D:/Webscrape/webscrape"
setwd(dir)
source("functions.R")

# read the data
text = call_data(site = "vnexpress",index = "")
```

#Ví dụ 1 bài báo:
```{r}
message("Link: ",text$link[1])
cat("\nTieu de: ", text$title[1], "\n\n")
example = text$content[1]
example
```

#Tách lấy tiêu đề và 2 đoạn văn đầu:
```{r warning=FALSE}
# Function de xac dinh 2 doan van dau
first2_real_text = function(string) {
  string = str_split(string, "\n")[[1]]
  string = string[nchar(string)>1]
  string = string[1:2]
  return(string)
}
# Thuc hien
two_para = lapply(text$content,FUN = first2_real_text) %>% lapply(FUN=tolower)
two_para[c(1:2)]
```

#Search các bài có từ "tham nhũng" hoặc "hối lộ" trong: (1) Tiêu đề; hoặc (2) 2 đoạn văn đầu (đoạn đầu thường là intro của bài báo).

```{r}
# Khai bao tu khoa
key_cor = c("tham nhũng", "hối lộ")

# Xac dinh cac bai co tu khoa trong tieu de
title = tolower(text$title)
title_key = str_count(title, paste(key_cor,collapse="|"))

# Xac dinh cac bai co tu khoa trong 2 doan van dau
count_key = function(text_vector, keywords_vector) {
  count = str_count(text_vector,pattern=paste(keywords_vector,collapse="|"))
  count[which(is.na(count))] <- 0
  return(count)
}

para_key_all = lapply(two_para, count_key, keywords_vector = key_cor)
para_key = lapply(para_key_all,sum) %>% unlist()


# Tong hop ket qua 
contain_key = title_key + para_key
article_cor = text[which(contain_key>0),]
head(article_cor$title)


```

#Dưới đây là kết quả:
##Theo tháng:
```{r}
# Ve do thi 
library(xts)
library(ggplot2)
text = cbind(text,key_cor = (contain_key>0))
text$month = floor_date(text$date, unit = "month")
count = xts(text$key_cor[!is.na(text$date)], order.by = text$date[!is.na(text$date)])
count = apply.daily(count, FUN=sum)
# __xuat hien theo thoi gian
# ____theo thang

count_month = apply.monthly(count["2006/"], FUN=sum)
ggplot(count_month, aes(x=index(count_month),y=count_month)) +
  geom_line() + theme_light() +
  ylab("So bai bao") + xlab("Thang")




```

##Theo từng chuyên mục:
```{r}
# __theo chuyen muc
count_group = group_by(text,month,category) %>% summarise(contain = sum(key_cor))
count_group = count_group[order(count_group$month),]
count_group = count_group[!is.na(count_group$month),]
count_group = count_group[count_group$month > clean_date("31/12/2005"),]
ggplot(count_group,aes(x=month,y=contain)) +
  geom_line() + facet_wrap(~category) + theme_light()
```








